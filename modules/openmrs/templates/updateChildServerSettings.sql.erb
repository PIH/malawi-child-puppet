update global_property set property_value='<%= @child_name %>' where property='sync.server_name';
update global_property set property_value='<%= @sync_admin_email %>' where property='sync.admin_email';
update global_property set property_value='500' where property='sync.max_records.web';

-- select property_value into outfile '<%= @server_uuid_text_file %>' from global_property where property='sync.server_uuid';
select property_value from global_property where property='sync.server_uuid' into @child_server_uuid;
select @child_server_uuid;

insert into sync_server(nickname, address, server_type, username, password, uuid, disabled) 
values('<%= @sync_parent_name %>', '<%= @sync_parent_address %>', 'PARENT', '<%= @sync_parent_user_name %>', '<%= @sync_parent_user_password %>', '<%= @sync_parent_uuid %>', 0);

select last_insert_id() into @parent_server_id;
select @parent_server_id;

-- add the default sync classes not to send/export
insert into sync_server_class(class_id, server_id, send_to, receive_from) 
select class_id, @parent_server_id, 0, 0 from sync_class where default_send_to=0;

-- add org.openmrs
insert into sync_class(name, default_send_to, default_receive_from) 
values('org.openmrs', 1, 1);
select last_insert_id() into @org_openmrs_class_id;
-- do not receive any org.openmrs classes from the parent 
insert into sync_server_class(class_id, server_id, send_to, receive_from) 
values(@org_openmrs_class_id, @parent_server_id, 1, 0);

-- add org.openmrs.api.db.SerializedObject
insert into sync_class(name, default_send_to, default_receive_from) 
values('org.openmrs.api.db.SerializedObject', 1, 1);
select last_insert_id() into @org_openmrs_api_db_serializedobject_class_id;
-- do not send any org.openmrs.api.db.SerializedObject classes to the parent 
insert into sync_server_class(class_id, server_id, send_to, receive_from) 
values(@org_openmrs_api_db_serializedobject_class_id, @parent_server_id, 0, 1);


-- add org.openmrs.module.reporting
insert into sync_class(name, default_send_to, default_receive_from) 
values('org.openmrs.module.reporting', 1, 1);
select last_insert_id() into @org_openmrs_module_reporting_class_id;
-- do not send any org.openmrs.module.reporting classes to the parent 
insert into sync_server_class(class_id, server_id, send_to, receive_from) 
values(@org_openmrs_module_reporting_class_id, @parent_server_id, 0, 1);